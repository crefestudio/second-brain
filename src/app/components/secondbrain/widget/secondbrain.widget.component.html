<div class="view-wrapper">
  <div class="center-box">
    <!-- connect-button -->
    <div *ngIf="state=='connect-button'">
      <button class="connect-btn" (click)="onClickConnectBtn()">
        CONNECT
      </button>
    </div>    

    <!-- <div *ngIf="state=='session'">
      session - 인증은 되었는데 API연동은 아직 안된 상태
      모바일앱이라면 최초 연동은 데스크탑에서 진행해야 함
      인증 되었으니 데스크탑에서 연동하면 리로드하면 연결 될 것임
    </div> -->
    <!-- connect-notion -->
    <ng-container *ngIf="state=='connect-notion'">
      <div class="connect-container">
        <div class="info-text"
          style="display:block;padding: 8px 16px; line-height: 1.5em; font-size: 0.875rem; color:#ffffff; margin-bottom: 0px;font-size: 16px;">
          <strong>브라우저에 열린 창에서 연결작업을 완료한 후,<br>아래 버튼을 눌러주세요.</strong><br>
        </div>
        <div class="input-group" style="display:flex; gap: 8px; padding: 0 16px;font-size: 14px;">
          <button class="connect-btn" (click)="onClickCheckConnecttBtn()">
            연결 확인
          </button>
        </div>
        <br>
        <small class="info-text"
              style="display:block; padding: 8px 16px; line-height: 1.5em; font-size: 12px; color: #959595; margin-bottom: 18px; text-align: left;">
          • <span style="color: #fd5712;">노션 모바일 앱에서는 새 창이 열리지 않아 연결을 완료 할 수 없습니다.</span><br/>
          • <span style="color: #fd5712;">세컨드브레인 API를 <strong>처음 연결 하실 때</strong>는 <strong>웹브라우저</strong> 환경에서만 진행할 수 있습니다.</span><br/>
          • 기타 API 연결 및 이용 관련 문의는 <strong>toto791&#64;gmail.com</strong>으로 연락해 주세요.<br/>
        </small>
      </div>
    </ng-container>

    <!-- emial -->
    <ng-container *ngIf="state=='email-input-'">
      <div class="connect-container">
        <div class="info-text"
          style="display:block;padding: 0 16px; line-height: 1.0em; font-size: 0.875rem; color:#ffffff; margin-bottom: 0px;font-size: 16px;">
          <strong>LifeUp • SecondBrain API</strong><br><br>
        </div>
        <small class="info-text"
          style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 0.875rem; color: #aaaaaa; margin-bottom: 18px;font-size: 12px;">
          API 연결을 위해 템플릿 <span style="color: #F2561D;">구매 시 등록한 이메일</span>을 입력해주세요.<br />  
        </small>
        <div class="input-group" style="display:flex; gap: 8px; padding: 0 16px;">
          <button class="back-btn" (click)="goBackState()" title="뒤로가기"
            style="background:none; border:none; padding:0; cursor:pointer;">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor">
              <path d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"></path>
              <path
                d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z">
              </path>
            </svg>
          </button>
          <input type="text" placeholder="이메일을 입력해주세요." [(ngModel)]="email"
            style="padding: 8px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 14ch; box-sizing: border-box;width: 24ch;font-size: 13px;" />
          <button [disabled]="isEmailSending" 
                  (click)="onSubmitEmail()"
                  [ngClass]="{'btn-disabled': isEmailSending, 'btn-active': !isEmailSending}">
            확인
          </button>
        </div>
        <br/>
        <small class="info-text"
              style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 12px; color: #959595; margin-bottom: 18px; text-align: left;">
          • <span style="color: #b34347;">세컨드브레인 API를 <strong>처음 연결 하실 때</strong>는 <strong>웹브라우저</strong> 환경에서만 진행할 수 있습니다.</span><br/>
          • <span style="color: #b34347;">연결 후 <strong>모바일 장치</strong>에서 추가 연결 할 수 있으며, 각 장치에서는 보안상 별도 인증이 필요합니다.</span><br/>
          • 세컨드브레인 API는 노션 계정당 LifeUp 템플릿 1개만 사용 가능합니다. 연결 할 때 이용 할 템플릿을 선택해주세요.<br/>
          • 구매 시 등록한 이메일을 잊어버린 경우, 현재 사용 중인 이메일로 먼저 연결 한 후 관리자에게 문의해주세요.<br/>
          • 기타 API 연결 및 이용 관련 문의는 <strong>toto791&#64;gmail.com</strong>으로 연락해 주세요.<br/>
        </small>


      </div>
    </ng-container>

    <ng-container *ngIf="state=='email-input'">
      <div class="connect-container sb-change-url">
          <!-- <div class="info-text title-text">
            <strong>이메일 인증 완료</strong>
          </div> -->
          <div class="info-text"
              style="display:block;padding: 0 16px; line-height: 0.65em; color:#ffffff; margin-bottom: 0px;font-size: 22px;">
              <strong>이메일 인증 완료</strong><br><br>
          </div>
          <small class="info-text"
              style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 0.875rem; color: #aaaaaa; margin-bottom: 18px;font-size: 12px;">
            다음으로 세컨드브레인 위젯 주소를 교체합니다.<br>
            아래 내용을 보시고 진행해주세요.
          </small>
          <!-- <small class="info-text desc-text">
            이메일 인증이 완료되었습니다.<br />
            아래 단계만 진행하시면 세컨드브래인 위젯 연결이 마무리됩니다.
          </small> -->

          <!-- STEP 1 -->
          <small class="info-text step-title">
            1️⃣ 내 위젯 주소 복사
          </small>

           <!-- <input type="text" placeholder="이메일을 입력해주세요." [(ngModel)]="email"
            style="padding: 8px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 14ch; box-sizing: border-box;width: 24ch;font-size: 13px;" />
          <button [disabled]="isEmailSending" 
                  (click)="onSubmitEmail()"
                  [ngClass]="{'btn-disabled': isEmailSending, 'btn-active': !isEmailSending}">
            확인
          </button> -->

          <div class="input-group" style="margin: 12px 0 16px;">
            <input type="text" placeholder="이메일을 입력해주세요." [(ngModel)]="clientUrl"
              style="padding: 8px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 14ch; box-sizing: border-box;width: 42ch;font-size: 12px;">
            <button class="btn-active" (click)="copyUrl()">
              복사
            </button>
          </div>

          <!-- <small class="info-text hint-text">
            보안 및 개인화 설정을 위해 위젯 주소를 변경해야 합니다.
          </small> -->

          <!-- STEP 2 -->
          <small class="info-text step-title">
            2️⃣ 노션에서 SecondBrain 위젯 주소 바꾸기
          </small>

          <!-- <small class="info-text list-text">
            • 위젯 우측 상단 <strong> ⋯ 메뉴</strong> 클릭<br /> <strong>바꾸기</strong> 선택<br />
            • 주소 붙여넣기 후 <strong>링크 임베드</strong> 선택
          </small> -->

          <div class="image-placeholder">
            이미지 안내 영역
          </div>

          <small class="info-text warning-text">
            ※ 위젯 주소를 변경하지 않으면 인증이 적용되지 않습니다.
          </small>
        </div>
    </ng-container>
    
    <!-- certification -->
    <div class="email-certi-wrapper" [class.inactive]="state !== 'email-certification'">
      <div class="connect-container">
        <div class="info-text"
          style="display:block;padding: 0 16px; line-height: 1.0em; font-size: 0.875rem; color:#ffffff; margin-bottom: 0px;font-size: 16px;">
          <strong>인증번호 확인</strong><br><br>
        </div>
        <small class="info-text"
          style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 0.875rem; color: #aaaaaa; margin-bottom: 18px;font-size: 12px;">
          {{email}} 로 인증번호를 발송했습니다. 메일을 확인하신 수 인증번호 6자리를 입력해주세요.<br />
        </small>
        <div class="input-group" style="display:flex; gap: 8px; padding: 0 16px;">
          <button class="back-btn" (click)="goBackState()" title="뒤로가기"
            style="background:none; border:none; padding:0; cursor:pointer;">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor">
              <path d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"></path>
              <path
                d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z">
              </path>
            </svg>
          </button>

          <input #codeInput0 class="code-input" type="text"  inputmode="numeric" pattern="[0-9]" maxlength="1" [value]="codeArray[0]" [disabled]="isVerifying" 
            (input)="onInputNumber($event, 0)" (keydown.backspace)="onBackspace($event, 0)"/>
          <input class="code-input" type="text"  inputmode="numeric" pattern="[0-9]" maxlength="1" [value]="codeArray[1]" [disabled]="isVerifying" 
            (input)="onInputNumber($event, 1)" (keydown.backspace)="onBackspace($event, 1)"/>
          <input class="code-input" type="text"  inputmode="numeric" pattern="[0-9]" maxlength="1" [value]="codeArray[2]" [disabled]="isVerifying" 
            (input)="onInputNumber($event, 2)" (keydown.backspace)="onBackspace($event, 2)"/>
          <input class="code-input" type="text"  inputmode="numeric" pattern="[0-9]" maxlength="1" [value]="codeArray[3]" [disabled]="isVerifying" 
            (input)="onInputNumber($event, 3)" (keydown.backspace)="onBackspace($event, 3)"/>
          <input class="code-input" type="text"  inputmode="numeric" pattern="[0-9]" maxlength="1" [value]="codeArray[4]" [disabled]="isVerifying" 
            (input)="onInputNumber($event, 4)" (keydown.backspace)="onBackspace($event, 4)"/>
          <input class="code-input" type="text"  inputmode="numeric" pattern="[0-9]" maxlength="1" [value]="codeArray[5]" [disabled]="isVerifying" 
            (input)="onInputNumber($event, 5)" (keydown.backspace)="onBackspace($event, 5)"/>
         

          <!-- <button (click)="onSubmitCertificationNumber()"style="padding: 8px 12px; font-size: 12px; border-radius: 6px; border:none; background:#007AFF; color:white; width:auto; flex-shrink:0;">
          확인
        </button> -->
        </div>
      </div>
    </div>   

    <!-- phoneNumber -->
    <!-- <ng-container *ngIf="state=='phoneNumber'">
    <div class="connect-container">
      <div class="info-text" style="display:block;padding: 0 16px; line-height: 1.0em; font-size: 0.875rem; color:#ffffff; margin-bottom: 0px;font-size: 16px;">
        <strong>Notionable · SecondBrain API</strong><br><br>
      </div>
      <small class="info-text" style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 0.875rem; color: #aaaaaa; margin-bottom: 18px;font-size: 12px;">
        API 연결을 위해 템플릿 구매 시 등록한 휴대폰 번호를 입력해주세요.<br/> 
        ※ 입력하신 번호는 API연결과 구매자 확인 용도로만 사용됩니다.
      </small>
      <div class="input-group" style="display:flex; gap: 8px; padding: 0 16px;">
        <button
          class="back-btn"
          (click)="goBackState()"
          title="뒤로가기"
          style="background:none; border:none; padding:0; cursor:pointer;"
        >
          <svg viewBox="0 0 1024 1024"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor">
            <path d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"></path>
            <path d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z"></path>
          </svg>
        </button>
        <input
          type="tel"
          placeholder="구매 시 등록한 휴대폰 번호"
          [(ngModel)]="phoneNumber"
          (input)="formatPhoneNumber()"
          style="padding: 8px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 14ch; box-sizing: border-box;width: 24ch;font-size: 13px;"
        />
        <button (click)="onSubmitPhoneNumber()"style="padding: 8px 12px; font-size: 12px; border-radius: 6px; border:none; background:#007AFF; color:white; width:auto; flex-shrink:0;">
          확인
        </button>
      </div>
    </div>
  </ng-container> -->

    <!-- connectKey -->
    <!--    
  <ng-container *ngIf="state=='connectKey'">
    <div class="connect-container">
      <div class="info-text" style="display:block;padding: 0 16px; line-height: 1.0em; font-size: 0.875rem; color:#ffffff; margin-bottom: 0px;font-size: 16px;">
        <strong>Notionable · SecondBrain API</strong><br><br>
      </div>
      <small class="info-text" style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 0.875rem; color: #aaaaaa; margin-bottom: 18px;font-size: 12px;">
        새 브라우저 창에서 SecondBrain API 연결을 완료한 뒤, 발급된 연결 키를 아래에 입력해 주세요. 
      </small>
      <div class="input-group" style="display:flex; gap: 8px; padding: 0 16px;">
        <button
          class="back-btn"
          (click)="goBackState()"
          title="뒤로가기"
          style="background:none; border:none; padding:0; cursor:pointer;"
        >
          <svg viewBox="0 0 1024 1024"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor">
            <path d="M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64z"></path>
            <path d="m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312L237.248 512z"></path>
          </svg>
        </button>

        <input
          type="tel"
          placeholder="연결키를 입력해주세요."
          [(ngModel)]="connectKey"
          style="padding: 8px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 14ch; box-sizing: border-box;width: 32ch;font-size: 13px;"
        />
        <button (click)="onSubmitConnectKey()"style="padding: 8px 12px; font-size: 12px; border-radius: 6px; border:none; background:#007AFF; color:white; width:auto; flex-shrink:0;">
          확인
        </button>
      </div>
    </div>
  </ng-container> -->

    <!-- <ng-container *ngIf="state=='change-client-url'">

      이 위치에 세컨드브레인 고유 위젯 주소입니다.
      이 주소를 현재 주소와 교체를 진행해야 다음단계로 노션 연결이 진행됩니다. 
      아래 주소를 복사해서 이 화면 우측 상단에 메뉴>바꾸기 를 한 후 주소를 붙여넣기 해주세요.

      https://notionable.net/secondbrain/widget/{{clientId}}

      secondbrain 인증, 클라이언트 인증 성공 / 아직 노션 연결은 안함
      위젯 주소 교체
      복사 

      바꾸기 그림 설명

      'change-client-url'
    </ng-container> -->


    
    <!-- <div *ngIf="state=='connect-client'">
        이메일 인증와 완료 되었습니다. 
        두가지 작업이 더 남았습니다. 

        첫째, 세컨드브래인 위젯의 주소를 바꿔주세요. (보안과 개인화 설정을 위해)        
 
        1. 위젯 주소를 복사 한 후 
        [ {{email}}                           ] [복사]

        2 위젯 오른쪽 상단 ... 메뉴 클릭 > 바꾸기 > 붙여넣기 > 링크 임베드 

        여기는 이미지로 안내 예정        

        <div *ngIf="state=='success'" class="success-wrapper">
          <div class="success-card">
            <h1 class="title">🎉 Notion ↔ API 연결 성공!</h1>

            <p class="desc">
              SecondBrain API 연결키를 성공적으로 발급했습니다.<br>
              ⚠️아래의 연결키를 <strong>LifeUp 템플릿 세컨드브래인 위젯</strong>에 등록해주셔야
              연결이 완료됩니다.
            </p>

            <div class="key-box">
              <input
                type="text"
                class="key-input"
                [value]="botId"
                readonly
              />
              <button class="copy-btn" (click)="copyKey()">
                복사
              </button>
            </div>
          </div>
        </div> 
    </div>  -->

    <!-- 연결 성공 표시 -->
    <ng-container *ngIf="state=='success'">
      <div class="success-wrapper">
        <div class="success-card">
          <h1 class="title">🎉 SecondBrain API 연결이 완료되었습니다.</h1>

          <p class="desc">
            아래 그래프 보기를 누르면 API 동작이 시작됩니다.<br>
          </p>

          <button class="home-btn" (click)="goGraph()">
            그래프 보기
          </button>
        </div>
      </div>
    </ng-container>


    <!-- 에러메세지 -->
    <div *ngIf="state !== 'graph'" class="error-message" [innerHTML]="errorMessage">
    </div>
    <div *ngIf="state !== 'graph'" class="warn-message" [innerHTML]="warnMessage">
    </div>

    <!-- 그래프 오류 - 데이터 없음 -->
    <ng-container *ngIf="state=='graph-nodata'">
      <div class="success-wrapper">
        <div class="success-card">
          <h1 class="title">⛔ 그래프를 표시할 데이터가 없습니다.</h1>

          <small class="info-text"
              style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 13px; color: #959595; margin-bottom: 18px; text-align: left;">
            새 노트를 작성하면 AI가 내용을 분석해 키워드를 자동으로 생성하고, 완료 후 노트의 ‘키워드’ 속성에 표시됩니다.<br>
            생성된 키워드를 기반으로 그래프가 구성됩니다.<br><br>
            초기 연결 시 기존 노트는 자동 변환이 지원되지 않으며,<br>
            처리 시간 문제로 현재는 5개씩 수동 변환 방식으로 제공되고 있습니다.
          </small>

           <!-- <small class="info-text"
              style="display:block; padding: 0 16px; line-height: 1.5em; font-size: 12px; color: #959595; margin-bottom: 18px; text-align: left;">
          • <span style="color: #b34347;">세컨드브레인 API를 처음 연결 하실 때는 <strong>웹브라우저</strong> 환경에서만 진행할 수 있습니다.</span><br/>
          • <span style="color: #b34347;">연결 후 <strong>모바일 장치</strong>에서 추가 연결 할 수 있으며, 각 장치에서는 보안상 별도 인증이 필요합니다.</span><br/>
          • 세컨드브레인 API는 노션 계정당 LifeUp 템플릿 1개만 사용 가능합니다. 연결 할 때 이용 할 템플릿을 선택해주세요.<br/>
          • 구매 시 등록한 이메일을 잊어버린 경우, 현재 사용 중인 이메일로 먼저 연결 한 후 관리자에게 문의해주세요.<br/>
          • 기타 API 연결 및 이용 관련 문의는 <strong>toto791&#64;gmail.com</strong>으로 연락해 주세요.<br/>
        </small> -->

          <!-- <p class="desc">
            새로운 노트를 작성하면 AI가 내용을 분석해 자동으로 키워드를 생성하고,<br>
            작업이 완료되면 노트의 ‘키워드’ 속성에 반영됩니다.<br>
            이 키워드를 기반으로 세컨드 브레인 그래프가 생성됩니다.<br>

            초기 연결 시 기존 노트의 자동 변환 기능은 아직 준비 중입니다.<br>
            처리 시간이 소요되는 관계로, 현재는 한 번에 5개씩<br>
            아래 버튼을 눌러 수동으로 변환할 수 있습니다.
          </p> -->

          <button class="home-btn" (click)="onClickGenerateNotionNoteKMDataBatch()">
            AI 노트 데이터 전환하기 - 5개
          </button>
        </div>
      </div>
    </ng-container>


    <!-- 그래프 영역 -->
    <div class="graph-wrapper" [class.inactive]="state !== 'graph'">
      <div class="graph-container" #graphContainer>
      </div>

      <!-- 메뉴 -->
      <div class="graph-menu" *ngIf="isMenuOpen" (click)="$event.stopPropagation()">
        <!-- 창 열기 -->
        <!-- <button class="menu-item" (click)="onClickSettings()">
          <span class="menu-icon">
            <svg style="width: 23px; height: 23px;" viewBox="0 0 24 24" fill="none">
              <path d="M7 17L17 7M17 7H8M17 7V16"
                stroke="#cfd0d3"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </span>
          <span class="menu-text">창 열기</span>
        </button> -->

        <!-- 설정 -->
        <button class="menu-item divider" (click)="onClickSettings()">
          <span class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12.0002 8C9.79111 8 8.00024 9.79086 8.00024 12C8.00024 14.2091 9.79111 16 12.0002 16C14.2094 16 16.0002 14.2091 16.0002 12C16.0002 9.79086 14.2094 8 12.0002 8ZM10.0002 12C10.0002 10.8954 10.8957 10 12.0002 10C13.1048 10 14.0002 10.8954 14.0002 12C14.0002 13.1046 13.1048 14 12.0002 14C10.8957 14 10.0002 13.1046 10.0002 12Z" fill="#cfd0d3"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.2867 0.5C9.88583 0.5 8.6461 1.46745 8.37171 2.85605L8.29264 3.25622C8.10489 4.20638 7.06195 4.83059 6.04511 4.48813L5.64825 4.35447C4.32246 3.90796 2.83873 4.42968 2.11836 5.63933L1.40492 6.83735C0.67773 8.05846 0.954349 9.60487 2.03927 10.5142L2.35714 10.7806C3.12939 11.4279 3.12939 12.5721 2.35714 13.2194L2.03927 13.4858C0.954349 14.3951 0.67773 15.9415 1.40492 17.1626L2.11833 18.3606C2.83872 19.5703 4.3225 20.092 5.64831 19.6455L6.04506 19.5118C7.06191 19.1693 8.1049 19.7935 8.29264 20.7437L8.37172 21.1439C8.6461 22.5325 9.88584 23.5 11.2867 23.5H12.7136C14.1146 23.5 15.3543 22.5325 15.6287 21.1438L15.7077 20.7438C15.8954 19.7936 16.9384 19.1693 17.9553 19.5118L18.3521 19.6455C19.6779 20.092 21.1617 19.5703 21.8821 18.3606L22.5955 17.1627C23.3227 15.9416 23.046 14.3951 21.9611 13.4858L21.6432 13.2194C20.8709 12.5722 20.8709 11.4278 21.6432 10.7806L21.9611 10.5142C23.046 9.60489 23.3227 8.05845 22.5955 6.83732L21.8821 5.63932C21.1617 4.42968 19.678 3.90795 18.3522 4.35444L17.9552 4.48814C16.9384 4.83059 15.8954 4.20634 15.7077 3.25617L15.6287 2.85616C15.3543 1.46751 14.1146 0.5 12.7136 0.5H11.2867ZM10.3338 3.24375C10.4149 2.83334 10.7983 2.5 11.2867 2.5H12.7136C13.2021 2.5 13.5855 2.83336 13.6666 3.24378L13.7456 3.64379C14.1791 5.83811 16.4909 7.09167 18.5935 6.38353L18.9905 6.24984C19.4495 6.09527 19.9394 6.28595 20.1637 6.66264L20.8771 7.86064C21.0946 8.22587 21.0208 8.69271 20.6764 8.98135L20.3586 9.24773C18.6325 10.6943 18.6325 13.3057 20.3586 14.7523L20.6764 15.0186C21.0208 15.3073 21.0946 15.7741 20.8771 16.1394L20.1637 17.3373C19.9394 17.714 19.4495 17.9047 18.9905 17.7501L18.5936 17.6164C16.4909 16.9082 14.1791 18.1618 13.7456 20.3562L13.6666 20.7562C13.5855 21.1666 13.2021 21.5 12.7136 21.5H11.2867C10.7983 21.5 10.4149 21.1667 10.3338 20.7562L10.2547 20.356C9.82113 18.1617 7.50931 16.9082 5.40665 17.6165L5.0099 17.7501C4.55092 17.9047 4.06104 17.714 3.83671 17.3373L3.1233 16.1393C2.9058 15.7741 2.97959 15.3073 3.32398 15.0186L3.64185 14.7522C5.36782 13.3056 5.36781 10.6944 3.64185 9.24779L3.32398 8.98137C2.97959 8.69273 2.9058 8.2259 3.1233 7.86067L3.83674 6.66266C4.06106 6.28596 4.55093 6.09528 5.0099 6.24986L5.40676 6.38352C7.50938 7.09166 9.82112 5.83819 10.2547 3.64392L10.3338 3.24375Z" fill="#cfd0d3"></path> </g></svg>
          
          </span>
          <span class="menu-text">설정</span>
        </button>

         <!-- 노트-키워드 -->
        <button class="menu-item" (click)="onClickSelectGraphType('note-keyword')">
          <span class="menu-icon">
            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M17.8321 9.5547C18.1384 9.09517 18.0142 8.4743 17.5547 8.16795C17.0952 7.8616 16.4743 7.98577 16.168 8.4453L13.3925 12.6085L10.0529 10.3542C9.421 9.92768 8.55941 10.1339 8.18917 10.8004L6.12584 14.5144C5.85763 14.9971 6.03157 15.6059 6.51436 15.8742C6.99714 16.1424 7.60594 15.9684 7.87416 15.4856L9.56672 12.439L12.8571 14.66C13.4546 15.0634 14.2662 14.9035 14.6661 14.3036L17.8321 9.5547Z" fill="#cfd0d3"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M7 2C4.23858 2 2 4.23858 2 7V17C2 19.7614 4.23858 22 7 22H17C19.7614 22 22 19.7614 22 17V7C22 4.23858 19.7614 2 17 2H7ZM4 7C4 5.34315 5.34315 4 7 4H17C18.6569 4 20 5.34315 20 7V17C20 18.6569 18.6569 20 17 20H7C5.34315 20 4 18.6569 4 17V7Z" fill="#cfd0d3"></path> </g></svg>
          </span>
          <span class="menu-text">노트-키워드 그래프</span>
        </button>

        <!-- 키워드 -->
        <button class="menu-item divider" (click)="onClickSelectGraphType('keyword-only')">
          <span class="menu-icon">
            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M17.8321 9.5547C18.1384 9.09517 18.0142 8.4743 17.5547 8.16795C17.0952 7.8616 16.4743 7.98577 16.168 8.4453L13.3925 12.6085L10.0529 10.3542C9.421 9.92768 8.55941 10.1339 8.18917 10.8004L6.12584 14.5144C5.85763 14.9971 6.03157 15.6059 6.51436 15.8742C6.99714 16.1424 7.60594 15.9684 7.87416 15.4856L9.56672 12.439L12.8571 14.66C13.4546 15.0634 14.2662 14.9035 14.6661 14.3036L17.8321 9.5547Z" fill="#cfd0d3"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M7 2C4.23858 2 2 4.23858 2 7V17C2 19.7614 4.23858 22 7 22H17C19.7614 22 22 19.7614 22 17V7C22 4.23858 19.7614 2 17 2H7ZM4 7C4 5.34315 5.34315 4 7 4H17C18.6569 4 20 5.34315 20 7V17C20 18.6569 18.6569 20 17 20H7C5.34315 20 4 18.6569 4 17V7Z" fill="#cfd0d3"></path> </g></svg>
           
          </span>
          <span class="menu-text">키워드 그래프</span>
        </button>


        <!-- AI 노트 키워드 전환 -->
        <button class="menu-item" (click)="onClickGenerateNotionNoteKMDataBatch()">
          <span class="menu-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M14 2C14 2.74028 13.5978 3.38663 13 3.73244V4H20C21.6569 4 23 5.34315 23 7V19C23 20.6569 21.6569 22 20 22H4C2.34315 22 1 20.6569 1 19V7C1 5.34315 2.34315 4 4 4H11V3.73244C10.4022 3.38663 10 2.74028 10 2C10 0.895431 10.8954 0 12 0C13.1046 0 14 0.895431 14 2ZM4 6H11H13H20C20.5523 6 21 6.44772 21 7V19C21 19.5523 20.5523 20 20 20H4C3.44772 20 3 19.5523 3 19V7C3 6.44772 3.44772 6 4 6ZM15 11.5C15 10.6716 15.6716 10 16.5 10C17.3284 10 18 10.6716 18 11.5C18 12.3284 17.3284 13 16.5 13C15.6716 13 15 12.3284 15 11.5ZM16.5 8C14.567 8 13 9.567 13 11.5C13 13.433 14.567 15 16.5 15C18.433 15 20 13.433 20 11.5C20 9.567 18.433 8 16.5 8ZM7.5 10C6.67157 10 6 10.6716 6 11.5C6 12.3284 6.67157 13 7.5 13C8.32843 13 9 12.3284 9 11.5C9 10.6716 8.32843 10 7.5 10ZM4 11.5C4 9.567 5.567 8 7.5 8C9.433 8 11 9.567 11 11.5C11 13.433 9.433 15 7.5 15C5.567 15 4 13.433 4 11.5ZM10.8944 16.5528C10.6474 16.0588 10.0468 15.8586 9.55279 16.1056C9.05881 16.3526 8.85858 16.9532 9.10557 17.4472C9.68052 18.5971 10.9822 19 12 19C13.0178 19 14.3195 18.5971 14.8944 17.4472C15.1414 16.9532 14.9412 16.3526 14.4472 16.1056C13.9532 15.8586 13.3526 16.0588 13.1056 16.5528C13.0139 16.7362 12.6488 17 12 17C11.3512 17 10.9861 16.7362 10.8944 16.5528Z" fill="#cfd0d3"></path> </g></svg>
            
          </span>
          <span class="menu-text">AI 노트 키워드 추출</span>
        </button>

        <!-- 다시 그리기 -->
        <button class="menu-item divider" (click)="onClickReloadGraph()">
          <span class="menu-icon">
             <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4.06189 13C4.02104 12.6724 4 12.3387 4 12C4 7.58172 7.58172 4 12 4C14.5006 4 16.7332 5.14727 18.2002 6.94416M19.9381 11C19.979 11.3276 20 11.6613 20 12C20 16.4183 16.4183 20 12 20C9.61061 20 7.46589 18.9525 6 17.2916M9 17H6V17.2916M18.2002 4V6.94416M18.2002 6.94416V6.99993L15.2002 7M6 20V17.2916" stroke="#cfd0d3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
          
          </span>
          <span class="menu-text">다시 그리기</span>
        </button>

       
        <!-- 연결 끊기 -->
        <button class="menu-item danger" (click)="onClickDisconnect()">
          <span class="menu-icon size-lg">
            <svg style="width: 23px; height: 23px;" viewBox="0 0 36 36"  xmlns="http://www.w3.org/2000/svg">
              <path
                d="M12.17,6A6.21,6.21,0,0,0,6,11H2.13v2H6a6.23,6.23,0,0,0,6.21,5H17V6ZM15.1,16H12.17a4.2,4.2,0,0,1-4.31-4,4.17,4.17,0,0,1,4.31-4H15.1Z"
                fill="#cfd0d3" />
              <path
                d="M33.92,23H30.14a6.25,6.25,0,0,0-6.21-5H19v2H14a1,1,0,1,0,0,2h5v4H14a1,1,0,0,0-1,1,1,1,0,0,0,1,1h5v2h4.94a6.23,6.23,0,0,0,6.22-5h3.76Zm-10,5H21V20h2.94a4.17,4.17,0,0,1,4.31,4A4.17,4.17,0,0,1,23.94,28Z"
                fill="#cfd0d3" />
            </svg>
          </span>
          <span class="menu-text">연결 끊기</span>
        </button>
      </div> 
      <!-- } menu -->

      <!-- 컨펌 팝업  -->
      <div class="graph-menu confirm-box" *ngIf="isDisconnectConfirmOpen" (click)="$event.stopPropagation()">
        <div class="confirm-text">
          이 장치에서 API연결을 끊겠습니까?
        </div>

        <div class="confirm-actions">
          <button class="confirm-btn yes" (click)="confirmDisconnect()">
            예
          </button>
          <button class="confirm-btn no" (click)="cancelDisconnect()">
            아니요
          </button>
        </div>
      </div>

      <button class="graph-menu-btn" (click)="openGraphMenu($event)">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path
                d="M9 12C9 12.5523 8.55228 13 8 13C7.44772 13 7 12.5523 7 12C7 11.4477 7.44772 11 8 11C8.55228 11 9 11.4477 9 12Z"
                fill="#565656"></path>
              <path
                d="M13 12C13 12.5523 12.5523 13 12 13C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11C12.5523 11 13 11.4477 13 12Z"
                fill="#565656"></path>
              <path
                d="M16 13C16.5523 13 17 12.5523 17 12C17 11.4477 16.5523 11 16 11C15.4477 11 15 11.4477 15 12C15 12.5523 15.4477 13 16 13Z"
                fill="#565656"></path>
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M12.0574 1.25H11.9426C9.63424 1.24999 7.82519 1.24998 6.41371 1.43975C4.96897 1.63399 3.82895 2.03933 2.93414 2.93414C2.03933 3.82895 1.63399 4.96897 1.43975 6.41371C1.24998 7.82519 1.24999 9.63422 1.25 11.9426V12.0574C1.24999 14.3658 1.24998 16.1748 1.43975 17.5863C1.63399 19.031 2.03933 20.1711 2.93414 21.0659C3.82895 21.9607 4.96897 22.366 6.41371 22.5603C7.82519 22.75 9.63423 22.75 11.9426 22.75H12.0574C14.3658 22.75 16.1748 22.75 17.5863 22.5603C19.031 22.366 20.1711 21.9607 21.0659 21.0659C21.9607 20.1711 22.366 19.031 22.5603 17.5863C22.75 16.1748 22.75 14.3658 22.75 12.0574V11.9426C22.75 9.63423 22.75 7.82519 22.5603 6.41371C22.366 4.96897 21.9607 3.82895 21.0659 2.93414C20.1711 2.03933 19.031 1.63399 17.5863 1.43975C16.1748 1.24998 14.3658 1.24999 12.0574 1.25ZM3.9948 3.9948C4.56445 3.42514 5.33517 3.09825 6.61358 2.92637C7.91356 2.75159 9.62177 2.75 12 2.75C14.3782 2.75 16.0864 2.75159 17.3864 2.92637C18.6648 3.09825 19.4355 3.42514 20.0052 3.9948C20.5749 4.56445 20.9018 5.33517 21.0736 6.61358C21.2484 7.91356 21.25 9.62177 21.25 12C21.25 14.3782 21.2484 16.0864 21.0736 17.3864C20.9018 18.6648 20.5749 19.4355 20.0052 20.0052C19.4355 20.5749 18.6648 20.9018 17.3864 21.0736C16.0864 21.2484 14.3782 21.25 12 21.25C9.62177 21.25 7.91356 21.2484 6.61358 21.0736C5.33517 20.9018 4.56445 20.5749 3.9948 20.0052C3.42514 19.4355 3.09825 18.6648 2.92637 17.3864C2.75159 16.0864 2.75 14.3782 2.75 12C2.75 9.62177 2.75159 7.91356 2.92637 6.61358C3.09825 5.33517 3.42514 4.56445 3.9948 3.9948Z"
                fill="#565656"></path>
            </g>
          </svg>
      </button>
    </div> <!-- } graph-wrapper -->
    <!-- 전체 프로세스 상태 -->
    <div class="toast" [class.show]="isShowToast" [innerHTML]="toastMessage">
    </div>
    <!-- <div class="toast" *ngIf="isShowToast">
      {{ toastMessage }}
    </div> -->
</div>